/*

	objx core library
	Copyright (c) 2009 - 2010  Mat Ryer
	
	Contributors:
		Mat Ryer, Edd Grant, Simon Howard
	
	http://objx.googlecode.com/ - (See below for version number)
	 
	Permission is hereby granted, free of charge, to any person obtaining
	a copy of this software and associated documentation files (the
	"Software"), to deal in the Software without restriction, including
	without limitation the rights to use, copy, modify, merge, publish,
	distribute, sublicense, and/or sell copies of the Software, and to
	permit persons to whom the Software is furnished to do so, subject to
	the following conditions:

	The above copyright notice and this permission notice shall be
	included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
	EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
	MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
	NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
	LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
	OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
	WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
	
	For updates see http://code.google.com/p/objx/wiki/ChangeLog
	
*/var objx=function(e){return e&&e._objx?e:new objx.fn.init(e)},ODebug=!0,OAlwaysRememberBoundSource=!1,OVersion="2.3.7",ONew="ONew",OReplace="OReplace",OUnwrap="OUnwrap",OOriginal="OOriginal",OPlugins={},OConsole=function(e){typeof console!="undefined"&&console&&(console.warn(" "),objx(OArray(e)).each(function(e){typeof e=="string"?console.info("objx: "+e):console.info(e)}))},OArgArray=function(e){var t=[];return t.push.apply(t,e),t},OTrimOffFirstArg=function(e){var t=OArgArray(e);return t.splice(0,1),t},OError=function(){var e=arguments.length>1?arguments[0]:"Error",t=arguments[arguments.length-1];throw e+": "+t},OType=function(e){var t;return e!==null&&typeof e!="undefined"?(t=typeof e,t==="object"&&(typeof e.length!="undefined"?t="array":e._objx&&(t="objx"))):t="null",t},OExtend=function(){ODebug&&arguments.length<2&&OError("OExtend","Must provide at least two arguments when using OExtend(). See http://code.google.com/p/objx/wiki/extend");var e,t;for(e=1;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]},ORequires=function(e,t){if(!OPlugins[e]){var n=t?'by "'+t+'" ':"";OError("requires",'Plugin "'+e+'" is required '+n+"but missing. Are you missing a <script /> tag?  Have you got your <script /> tags in the wrong order?")}return this},OProvides=function(e){OPlugins[e]&&OError("provides",'A plugin called "'+e+'" has already been provided. Have you duplicated a <script /> tag?'),OPlugins[e]=!0},OProvided=function(e){return OPlugins[e]||!1};objx.fn=objx.prototype={_objx:!0,_obj:null,init:function(e){this.obj(e),this.kind=OType(e)},extend:function(){var e=[],t=0;e.push(this._obj);for(;t<arguments.length;t++)e.push(arguments[t]);return OExtend.apply(objx,e),this},obj:function(){return arguments.length===0?this._obj:(this._obj=arguments[0],this.kind=OType(this._obj),this)},size:function(){return this.kind!=="number"&&typeof this._obj.length=="undefined"&&OError("size","Cannot get the size of "+this.kind+"s."),this._obj.length||this._obj},toString:function(){var e=this.kind,t=this._obj.toString();switch(e){case"string":t='"'+t+'"';break;case"function":t=" ... ";break;case"array":var n=this.size();n===0?t="0":t=" 0.."+(n-1)+" "}return"objx:("+e+"("+t+"))"},requires:function(){for(var e=0,t=arguments.length;e<t;e++)ORequires(arguments[e],this.obj());return this}},objx.fn.init.prototype=objx.fn;var OIsObjx=function(e){return e&&e._objx?!0:!1},OBind=function(){var e=arguments[0]||null,t=arguments[1]||this,n=[],r=2,i=arguments.length,s;for(;r<i;r++)n.push(arguments[r]);s=function(){var r=[],s=0;for(s=0,i=n.length;s<i;s++)r.push(n[s]);for(s=0,i=arguments.length;s<i;s++)r.push(arguments[s]);return e.apply(t,r)};if(ODebug||OAlwaysRememberBoundSource)s.func=e,s.context=t,s.args=n;return s};Function.prototype.bind=function(){var e=[],t=0,n=arguments.length;e.push(this);for(;t<n;t++)e.push(arguments[t]);return OBind.apply(window,e)};var OAction=function(e,t){var n=t,r=e;t.requires&&objx(OArray(t.requires)).each(function(t){ORequires(t,'OAction("'+e+'")')}),objx.fn[e]=function(){var e,t=arguments[arguments.length-1],i=OArgArray(arguments),s;i.length>0&&(t instanceof Function||t===OOriginal||t===ONew||t===OReplace||t===OUnwrap)&&i.pop();if(n.collective){s=[];var o=[null,null].concat(i);this.each(function(t,i){e=n[OType(t)]||n.all||OError("."+r+"() does not support "+OType(t)+"s.  Are you working with the wrong type?  Check objx(o).kind to be sure."),o[0]=t,o[1]=i,s.push(e.apply(this,o))})}else e=n[this.kind]||n.all||OError("."+r+"() does not support "+this.kind+"s.  Are you working with the wrong type?  Check objx(o).kind to be sure."),s=e.apply(this,i);if(t instanceof Function)return t.apply(this,[s]),this;var u=n.action||OUnwrap,a;if(t===ONew||t===OReplace||t===OUnwrap||t===OOriginal)a=u=t;typeof s=="undefined"&&(a===OUnwrap?s=this.obj():s=this);switch(u){case OOriginal:return this;case ONew:return objx(s);case OReplace:return this.obj(s);default:return s}}},OGet=function(e,t){var n=!1;typeof e=="string"&&typeof t!="function"&&(e=e.split(""),n=!0);switch(typeof t){case"function":return t.apply(this,[e]);case"number":return typeof e=="string"?e.substr(OIndex(t,e.length),1):e[OIndex(t,e.length)];case"string":var r=t.toString().indexOf("[");r!=-1&&(t=t.replace("['",".").replace("[",".").replace('["',".").replace("']","").replace("]","").replace('"]',""));var s=t.toString().indexOf(".");return s==-1&&r==-1?e[t]:OGet(e[t.substring(0,s)],t.substring(s+1));case"object":if(t.length){var o=[],u=OIndex(t[0],e.length),a=OIndex(t[1],e.length);if(u<=a)for(i=u;i<=a;i++)o.push(e[i]);else for(i=u;i>=a;i--)o.push(e[i]);return n?o.join(""):o}}OError("OGet","OGet doesn't support that combination of parameters.")};OAction("get",{action:OUnwrap,all:function(e){return OGet(this._obj,e)}});var OCheck=function(e,t){var n,r,i,s=OType(t),o,u=OCheck.comparers,a=!0;if(s=="function")t(e)||(a=!1);else if(s=="object"){for(n in t)if(t.hasOwnProperty(n)){var f=!1;for(o in u)n==o&&(f=!0,u[o](e,t[n])||(a=!1));if(!f){i=OGet(e,n);if(typeof i!="undefined"){f=!0,r=t[n];switch(OType(r)){case"object":OCheck(i,r)||(a=!1);break;case"array":var l=!1;objx(r).each(function(e){if(OCheck(i,e))return l=!0,!1}),l||(a=!1);break;case"function":r(i,e)||(a=!1);break;default:OCheck.comparers.eq(i,r)||(a=!1)}}}f||OError("OCheck",'Unknown comparer token "'+n+"\".  It's not in OCheck.comparers nor is it a field name in the object being checked.  Are you calling this before including the right <script /> tag?  Have you mispelled the field name?")}}else OCheck.comparers.eq(e,t)||(a=!1);return a};OCheck.comparers={eq:function(e,t){if(OType(t)==="array"){var n=!1;return objx(t).each(function(t){if(OCheck(e,t))return n=!0,!1}),n}return e==t},eqs:function(e,t){return e===t},isnt:function(e,t){return!OCheck.apply(objx,arguments)},gt:function(e,t){return e>t},eqgt:function(e,t){return e>=t},lt:function(e,t){return e<t},eqlt:function(e,t){return e<=t},isType:function(e,t){return typeof e===t}},OCheck.comparers.above=OCheck.comparers.gt,OCheck.comparers.below=OCheck.comparers.lt,OCheck.comparers.is=OCheck.comparers.eq,OCheck.comparers.not=OCheck.comparers.isnt,OCheck.comparers[0]=function(){debugger},OAction("check",{all:function(e){return OCheck(this.obj(),e)}});var OIndex=function(e,t){return e>-1?e:t+e},OIndexRange=function(e,t,n){var r={};return r.start=OIndex(e,n),t?r.end=OIndex(t,n):e<0?r.end=n-1:r.end=r.start,e&&t&&(e=Math.min(r.start,r.end),t=Math.max(r.start,r.end),r.start=e,r.end=t),r},OIndexRangeIsBackwards=function(e,t){return OIndex(e[0],t)>OIndex(e[1],t)},OArray=function(e){return OType(e)!="array"?[e]:e};objx.toString=function(){return"{objx engine}"},objx.fn.each=function(){var e=this.obj(),t=0,n,r=arguments[arguments.length-1],i=arguments[0],s=!1;ODebug&&(r instanceof Function||OError("objx.each","Last argument to .each() must be a callback function.  "+typeof r+" is not allowed.")),typeof i=="object"&&OIndexRangeIsBackwards(i,this.size())&&(s=!0);if(i===!0||s===!0)switch(this.kind){case"string":t=this.size();for(;t--;)if(r.apply(this,[e.charAt(t),t])===!1)break;break;case"number":t=this.size();if(t>0){for(;t--;)if(r.apply(this,[t+1,t])===!1)break}else{n=-1;for(;t<=n;n--)if(r.apply(this,[n,0-n-1])===!1)break}break;case"array":t=this.size();for(;t--;)if(r.apply(this,[e[t],t])===!1)break;break;default:for(var o in e)if(r.apply(this,[e[o],o])===!1)break}else{this.kind!=="object"&&(n=this.size()),typeof i=="object"&&(t=OIndex(i[0],n),n=OIndex(i[1],n)+1);switch(this.kind){case"string":for(;t<n;t++)if(r.apply(this,[e.charAt(t),t])===!1)break;break;case"number":if(n>0){for(;t<n;t++)if(r.apply(this,[t+1,t])===!1)break}else{t=n;for(;t++;)if(r.apply(this,[t-1,t-n-1])===!1)break}break;case"array":for(;t<n;t++)if(r.apply(this,[e[t],t])===!1)break;break;default:for(var o in e)if(r.apply(this,[e[o],o])===!1)break}}return this};